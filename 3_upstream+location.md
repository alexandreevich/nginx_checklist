# üí° –ß—Ç–æ —Ç–∞–∫–æ–µ upstream?
upstream ‚Äî —ç—Ç–æ –±–ª–æ–∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ NGINX, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ backend-—Å–µ—Ä–≤–µ—Ä–æ–≤ –≤ "–ø—É–ª" –∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞—Ç—å –º–µ–∂–¥—É –Ω–∏–º–∏ –Ω–∞–≥—Ä—É–∑–∫—É.

–ü—Ä–∏–º–µ—Ä –ª–µ–∂–∏—Ç —Ç—É—Ç [upstream.conf](https://github.com/alexandreevich/nginx_checklist/blob/main/upstream/upstream.conf)

## –ì–¥–µ:
- my_app_servers ‚Äî —ç—Ç–æ –∏–º—è –ø—É–ª–∞.
- –°–ø–∏—Å–æ–∫ server –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞ ‚Äî —ç—Ç–æ IP-–∞–¥—Ä–µ—Å–∞ –∏–ª–∏ —Ö–æ—Å—Ç–Ω–µ–π–º—ã backend-—Å–µ—Ä–≤–∏—Å–æ–≤.
- –ö–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ NGINX, —Ç–æ—Ç —Å–∞–º —Ä–µ—à–∞–µ—Ç –Ω–∞ –∫–∞–∫–æ–π backend –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å.

## üéØ –¢–∏–ø—ã –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –≤ NGINX:

| –ú–µ—Ç–æ–¥	| –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç |
|--------|------------------------
| round-robin (–ø–æ –∫—Ä—É–≥—É)	|–°—Ç–∞–Ω–¥–∞—Ä—Ç. –ó–∞–ø—Ä–æ—Å—ã –ø–æ –æ—á–µ—Ä–µ–¥–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞.|
| least_conn	| –û—Ç–¥–∞—ë—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä —Å –Ω–∞–∏–º–µ–Ω—å—à–∏–º–∏ –∞–∫—Ç–∏–≤–Ω—ã–º–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏.|
|ip_hash	| –ù–∞–∑–Ω–∞—á–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä –Ω–∞ –æ—Å–Ω–æ–≤–µ IP –∫–ª–∏–µ–Ω—Ç–∞.|
|random	| –°–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä —Å–µ—Ä–≤–µ—Ä–∞ –∏–∑ —Å–ø–∏—Å–∫–∞.|

## ‚ö†Ô∏è –ó–∞—á–µ–º ?
- –¥–ª—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤;
- –¥–ª—è High Availability;
- –¥–ª—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤—ã—Ö —Å–∏—Å—Ç–µ–º;
- –ø—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ production-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∫–æ–ø–∏—è–º–∏ backend.

## üí° –í 99% —Å–ª—É—á–∞–µ–≤ DevOps –∏—Å–ø–æ–ª—å–∑—É–µ—Ç upstream –ø—Ä–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏:
- –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ —Ç—Ä–∞—Ñ–∏–∫–∞;
- –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤;
- —Ä–∞–∑—Ä—É–ª–∏–≤–∞–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏ –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∏–Ω—Å—Ç–∞–Ω—Å–∞–º–∏.

# üí° –ß—Ç–æ —Ç–∞–∫–æ–µ location-–±–ª–æ–∫–∏?
location ‚Äî —ç—Ç–æ –¥–∏—Ä–µ–∫—Ç–∏–≤–∞ –≤–Ω—É—Ç—Ä–∏ server {} –±–ª–æ–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ —Ä–∞–∑–Ω—ã–º URL-–ø—É—Ç—è–º.
–ò–º–µ–Ω–Ω–æ —Å –ø–æ–º–æ—â—å—é location —Ç—ã –∑–∞–¥–∞—ë—à—å:
- –∫–∞–∫–∏–µ —Ñ–∞–π–ª—ã –æ—Ç–¥–∞–≤–∞—Ç—å,
- –∫—É–¥–∞ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å,
- –∫–∞–∫ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã.

–ü—Ä–∏–º–µ—Ä - [location.conf](https://github.com/alexandreevich/nginx_checklist/blob/main/location.conf)

## üß† –¢–∏–ø—ã location-–±–ª–æ–∫–æ–≤:
|--------|------------------------|-----------------|
–¢–∏–ø | –ü—Ä–∏–º–µ—Ä | –û–ø–∏—Å–∞–Ω–∏–µ
Prefix match | location /api/ {} | –°–æ–≤–ø–∞–¥–∞–µ—Ç —Å –Ω–∞—á–∞–ª–æ–º URI. –ü—Ä–æ—Å—Ç–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ.
Exact match | location = /about {} | –°—Ç—Ä–æ–≥–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å URI.
Regex match (~) | location ~ \.php$ {} | –° –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π.
Case-insensitive (~*) | location ~* \.jpg$ {} | –ò–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä –±—É–∫–≤.

## ‚ö° –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Ä—è–¥–æ–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏:
- 1Ô∏è‚É£ –°–Ω–∞—á–∞–ª–∞ –∏—â–µ—Ç —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ =
- 2Ô∏è‚É£ –ü–æ—Ç–æ–º ‚Äî –¥–ª–∏–Ω–Ω–µ–π—à–∏–π –ø—Ä–µ—Ñ–∏–∫—Å /path/
- 3Ô∏è‚É£ –ü–æ—Ç–æ–º ‚Äî —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è (~ –∏ ~*).

## üî• –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- root ‚Äî —É–∫–∞–∑—ã–≤–∞–µ—Ç, –≥–¥–µ –∏—Å–∫–∞—Ç—å —Ñ–∞–π–ª—ã;
- alias ‚Äî –∑–∞–º–µ–Ω—è–µ—Ç –ø—É—Ç—å –≤ URL –Ω–∞ —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—É—Ç—å;
- proxy_pass ‚Äî –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–µ—Ä;
- try_files ‚Äî –ø—Ä–æ–±—É–µ—Ç –Ω–∞–π—Ç–∏ —Ñ–∞–π–ª –∏–ª–∏ –≤–µ—Ä–Ω—É—Ç—å 404.

### –ü—Ä–∏–º–µ—Ä —Å alias 
```
location /downloads/ {
    alias /mnt/data/;
}
```
–ó–∞–ø—Ä–æ—Å –∫ /downloads/file.zip –æ—Ç–¥–∞—Å—Ç —Ñ–∞–π–ª: /mnt/data/file.zip
‚ö†Ô∏è –í–∞–∂–Ω–æ: alias –Ω–µ –¥–æ–±–∞–≤–ª—è–µ—Ç /downloads/ –∫ –ø—É—Ç–∏, –∞ root –¥–æ–±–∞–≤–ª—è–µ—Ç!


### üí° –¢–∏–ø–∏—á–Ω—ã–π —Ä–∞–±–æ—á–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π:
```
location / {
    root /var/www/html;
    try_files $uri $uri/ /index.html;
}

location /api/ {
    proxy_pass http://backend:3000;
}
```
‚Äî –û—Ç–¥–∞—ë—Ç —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∫–∞–∫ SPA,
‚Äî –ü—Ä–æ–∫—Å–∏—Ä—É–µ—Ç /api –Ω–∞ backend.


